<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Фонарик</title>
<style>
body {
  text-align:center;
  margin-top:100px;
  font-family:Arial;
  transition: background 0.3s;
}
button {
  padding:20px 40px;
  font-size:22px;
}
</style>
</head>
<body>

<button id="btn">Включить фонарик</button>

<script>
let track;
let stream;
let isOn = false;
let screenLight = false;

const btn = document.getElementById("btn");

btn.addEventListener("click", async () => {

  // если уже включён экран-фонарик
  if (screenLight) {
    document.body.style.background = "";
    btn.textContent = "Включить фонарик";
    screenLight = false;
    return;
  }

  try {
    if (!stream) {
      stream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: "environment" }
      });
      track = stream.getVideoTracks()[0];
    }

    isOn = !isOn;

    await track.applyConstraints({
      advanced: [{ torch: isOn }]
    });

    btn.textContent = isOn ? "Выключить фонарик" : "Включить фонарик";

  } catch (err) {

    // если torch не поддерживается → включаем экран
    document.body.style.background = "white";
    btn.textContent = "Выключить экран-фонарик";
    screenLight = true;
  }

});
</script>

</body>
</html>
