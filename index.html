<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>QR Scanner</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://unpkg.com/html5-qrcode"></script>

<style>
body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background: #f2f2f7;
  margin: 0;
  padding: 15px;
}
.app { max-width: 420px; margin: auto; }
h2 { text-align: center; }

.card {
  background: white;
  border-radius: 16px;
  padding: 14px;
  margin-top: 15px;
  box-shadow: 0 4px 10px rgba(0,0,0,.08);
}

.row {
  display:flex;
  justify-content:space-between;
  padding:8px 0;
  border-bottom:1px solid #eee;
}
.row:last-child{border-bottom:none}

.label{font-size:13px;color:#888}
.value{font-size:16px;font-weight:500}

.scan-btn{
  width:100%;
  padding:14px;
  border:none;
  border-radius:14px;
  background:#34c759;
  color:#fff;
  font-size:16px;
}
.scan-btn.off{background:#aaa}

#reader{margin-top:10px;border-radius:16px;overflow:hidden;background:#000}
.scan-frame{
  position:absolute;inset:0;
  border:3px solid #fff;
  border-radius:16px;
  pointer-events:none;
}

.buttons{display:flex;gap:10px;margin-top:10px}
button{flex:1;padding:12px;border:none;border-radius:14px;font-size:14px}
.gray{background:#ddd}
.google{background:#4285f4;color:#fff}
.apple{background:#000;color:#fff}

.history-item{
  padding:8px;
  border-bottom:1px solid #eee;
  font-size:14px;
}
.history-item.active{
  background:#e5f0ff;
  border-radius:10px;
}

/* ===== Adressliste ===== */
.addr-item{
  padding:10px;
  border-bottom:1px solid #eee;
  display:flex;
  justify-content:space-between;
  font-size:14px;
}
.addr-item.selected{
  background:#dbe9ff;
  border-radius:10px;
}
.addr-actions{
  display:flex;
  gap:10px;
  margin-top:10px;
}
</style>
</head>

<body>
<div class="app">

<h2>üì∑ QR-Scanner</h2>
<button id="scanToggle" class="scan-btn">‚ñ∂Ô∏è Scannen</button>
<div id="reader"></div>

<div class="card">
  <div class="row">
    <div>
      <div class="label">Adresse</div>
      <div id="address" class="value">‚Äî</div>
    </div>
  </div>
  <div class="row">
    <div>
      <div class="label">Telefon</div>
      <div id="phone" class="value">‚Äî</div>
    </div>
  </div>
  <div class="row">
    <div>
      <div class="label">Betrag</div>
      <div id="amount" class="value">‚Äî</div>
    </div>
  </div>
</div>

<div class="card">
  <div class="label">Verlauf</div>
  <div id="history"></div>
</div>

<!-- ===== NEU: Adressliste ===== -->
<div class="card">
  <div class="label">Adressliste</div>
  <div id="addrList"></div>

  <div class="addr-actions">
    <button id="selectAll" class="google">Alle ausw√§hlen</button>
    <button id="clearAll" class="gray">Alle abw√§hlen</button>
  </div>
</div>

</div>

<script>
let history = JSON.parse(localStorage.getItem("qrHistory")||"[]");
let selectedIndex=null;
let selectedAddresses=new Set();

const addressEl=document.getElementById("address");
const phoneEl=document.getElementById("phone");
const amountEl=document.getElementById("amount");

function fill(item,index){
  selectedIndex=index;
  addressEl.textContent=item.address||"‚Äî";
  phoneEl.textContent=item.phone||"‚Äî";
  amountEl.textContent=item.amount||"‚Äî";
  renderHistory();
}

function renderHistory(){
  const box=document.getElementById("history");
  box.innerHTML="";
  history.forEach((i,idx)=>{
    const d=document.createElement("div");
    d.className="history-item"+(idx===selectedIndex?" active":"");
    d.innerHTML=`<b>${i.address||"‚Äî"}</b><br>üí∂ ${i.amount||"‚Äî"}`;
    d.onclick=()=>fill(i,idx);
    box.appendChild(d);
  });
  renderAddrList();
}

function renderAddrList(){
  const list=document.getElementById("addrList");
  list.innerHTML="";
  const sorted=[...history].sort((a,b)=>a.address.localeCompare(b.address));

  sorted.forEach(i=>{
    const d=document.createElement("div");
    d.className="addr-item"+(selectedAddresses.has(i.address)?" selected":"");
    d.innerHTML=`<span>${i.address}</span><b>${i.amount}</b>`;
    d.onclick=()=>{
      if(selectedAddresses.has(i.address)) selectedAddresses.delete(i.address);
      else selectedAddresses.add(i.address);
      renderAddrList();
    };
    list.appendChild(d);
  });
}

document.getElementById("selectAll").onclick=()=>{
  history.forEach(i=>selectedAddresses.add(i.address));
  renderAddrList();
};

document.getElementById("clearAll").onclick=()=>{
  selectedAddresses.clear();
  renderAddrList();
};

renderHistory();
</script>

</body>
</html>
