<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>QR Scanner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è QR -->
  <script src="https://unpkg.com/html5-qrcode"></script>

  <style>
    body { font-family: Arial; padding: 10px; }
    #reader { width: 100%; max-width: 400px; margin: auto; }
    input { width: 100%; margin: 5px 0; padding: 8px; }
    button { width: 100%; padding: 10px; margin-top: 10px; font-size: 16px; }
  </style>
</head>
<body>

<h3>üì∑ –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å QR</h3>

<div id="reader"></div>

<h3>üìÑ –î–∞–Ω–Ω—ã–µ</h3>
<input id="adresse" placeholder="–ê–¥—Ä–µ—Å">
<input id="telefon" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω">
<input id="betrag" placeholder="Betrag (‚Ç¨)">

<button onclick="call()">üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å</button>
<button onclick="navigate()">üó∫ –ù–∞–≤–∏–≥–∞—Ü–∏—è</button>

<script>
function onScanSuccess(text) {
  console.log(text);

  // –ø—Ä–∏–º–µ—Ä QR:
  // https://www.google.com/maps/search/?api=1&query=Street 1, 12345 City;tel=+491234567;betrag=12,50

  try {
    let decoded = decodeURIComponent(text);

    // –∞–¥—Ä–µ—Å
    let qm = decoded.match(/query=([^;&]+)/);
    if (qm) document.getElementById("adresse").value = qm[1];

    // —Ç–µ–ª–µ—Ñ–æ–Ω
    let tm = decoded.match(/tel=([^;&]+)/);
    if (tm) document.getElementById("telefon").value = tm[1];

    // betrag
    let bm = decoded.match(/betrag=([^;&]+)/);
    if (bm) {
      document.getElementById("betrag").value =
        bm[1].replace(",", ".");
    }

  } catch(e) {
    alert("–û—à–∏–±–∫–∞ QR");
  }
}

// –∫–∞–º–µ—Ä–∞
let html5QrCode = new Html5Qrcode("reader");
html5QrCode.start(
  { facingMode: "environment" },
  { fps: 10, qrbox: 250 },
  onScanSuccess
);

// –∫–Ω–æ–ø–∫–∏
function call() {
  let tel = document.getElementById("telefon").value;
  if (tel) window.location.href = "tel:" + tel;
}

function navigate() {
  let adr = document.getElementById("adresse").value;
  if (adr)
    window.location.href =
      "https://www.google.com/maps/search/?api=1&query=" + encodeURIComponent(adr);
}
</script>

</body>
</html>
